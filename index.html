<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plano de Leitura da Bíblia</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="manifest" href="manifest.json">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
</head>
<body>

    <!-- Cabeçalho Principal -->
    <header>
        <img id="header-logo" src="imagens/logo.png" alt="Logotipo do App">
        <div class="header-content">
            <h1>Meu Plano de Leitura</h1>
            <div id="user-status-container" class="user-status-container" style="display: none;">
                <span id="user-email"></span>
                <div id="header-loading" class="loading-indicator" style="display: none;">Carregando...</div>
                <button id="logout-button">Sair</button>
            </div>
        </div>
    </header>

    <main>
        <!-- Seção de Autenticação -->
        <section id="auth-section">
            <div id="auth-forms-container">
                <!-- Formulário de Login -->
                <form id="login-form">
                    <h2>Login</h2>
                    <div id="auth-error" class="error-message" style="display: none;"></div>
                    <label for="login-email">Email</label>
                    <input type="email" id="login-email" required>
                    <label for="login-password">Senha</label>
                    <input type="password" id="login-password" required>
                    <button type="submit" id="login-button" class="button-primary">Entrar</button>
                    <p>Não tem uma conta? <a href="#" id="show-signup-link">Cadastre-se</a></p>
                </form>

                <!-- Formulário de Cadastro -->
                <form id="signup-form" style="display: none;">
                    <h2>Cadastro</h2>
                    <div id="signup-error" class="error-message" style="display: none;"></div>
                    <label for="signup-email">Email</label>
                    <input type="email" id="signup-email" required>
                    <label for="signup-password">Senha</label>
                    <input type="password" id="signup-password" required>
                    <button type="submit" id="signup-button" class="button-primary">Cadastrar</button>
                    <p>Já tem uma conta? <a href="#" id="show-login-link">Faça login</a></p>
                </form>
            </div>
            <div id="auth-loading" class="loading-indicator" style="display: none;">Processando...</div>
        </section>

        <!-- Ações de Criação de Plano -->
        <section id="plan-creation-actions-section" class="plan-creation-actions-container" style="display: none;">
            <button id="create-new-plan-button" class="button-primary">Criar Novo Plano</button>
            <button id="create-favorite-plan-button" class="button-secondary">Criar Planos Favoritos</button>
            <button id="reassess-plans-button" class="button-special">Reavaliar Planos</button>
            <button id="explore-bible-button" class="button-edit">Explorar Bíblia</button>
        </section>

        <!-- Painéis de Perseverança e Atividade -->
        <section id="perseverance-panel-section" class="enhanced-panel" style="display: none;">
            <!-- Conteúdo será preenchido por perseverance-panel-ui.js -->
        </section>
        <section id="global-weekly-tracker-section" class="enhanced-panel" style="display: none;">
            <!-- Conteúdo será preenchido por weekly-tracker-ui.js -->
        </section>
        
        <!-- Painéis Laterais (Atrasos e Próximos) -->
        <section id="side-panels-section" style="display: none; background: none; box-shadow: none; padding: 0;">
            <!-- Conteúdo de overdue-readings e upcoming-readings será inserido aqui por side-panels-ui.js -->
        </section>

        <!-- Container para os Cards de Planos de Leitura -->
        <section id="plans-display-section" class="plans-display-container" style="display: none;">
            <!-- Cards dos planos serão renderizados aqui por reading-plan-ui.js -->
        </section>

        <!-- Seção de Criação/Edição de Plano -->
        <section id="plan-creation-section" style="display: none;">
            <h2 id="plan-creation-title">Criar Novo Plano</h2>
            <div id="plan-error" class="error-message" style="display: none;"></div>
            <input type="hidden" id="editing-plan-id">

            <fieldset>
                <legend>Informações Básicas</legend>
                <label for="plan-name">Nome do Plano</label>
                <input type="text" id="plan-name" placeholder="Ex: Jornada pelo Pentateuco">
                <label for="google-drive-link">Link do Google Drive (Opcional)</label>
                <input type="url" id="google-drive-link" placeholder="https://docs.google.com/document/d/...">
            </fieldset>

            <fieldset class="icon-selector-fieldset">
                <legend>Ícone do Plano</legend>
                <div id="icon-selector-container" class="icon-selector-container">
                    <!-- Ícones serão populados por plan-creation-ui.js -->
                </div>
            </fieldset>

            <fieldset id="plan-structure-fieldset">
                <legend>Estrutura do Plano</legend>
                
                <fieldset>
                    <legend>Método de Criação</legend>
                    <label><input type="radio" name="creation-method" value="interval" checked> Por Intervalo</label>
                    <label><input type="radio" name="creation-method" value="selection"> Por Seleção</label>
                    <label><input type="radio" name="creation-method" value="chapters-per-day"> Por Ritmo</label>
                </fieldset>

                <div id="interval-options">
                    <label for="start-book">De:</label>
                    <select id="start-book"></select>
                    <input type="number" id="start-chapter" placeholder="Cap.">
                    <label for="end-book">Até:</label>
                    <select id="end-book"></select>
                    <input type="number" id="end-chapter" placeholder="Cap.">
                </div>

                <div id="selection-options" style="display: none;">
                    <label for="books-select">Selecionar Livros Inteiros:</label>
                    <select id="books-select" multiple></select>
                    <label for="chapters-input">Ou Adicionar Capítulos Avulsos:</label>
                    <textarea id="chapters-input" rows="3" placeholder="Ex: Gn 1-3; Ex 20; Sl 23, 91, 119; Jo 3:16"></textarea>
                </div>
                
                <hr>

                <fieldset id="duration-options">
                    <legend>Duração</legend>
                    <label><input type="radio" name="duration-method" value="days" checked> Total de Dias</label>
                    <label><input type="radio" name="duration-method" value="end-date"> Data Final</label>
                </fieldset>

                <div id="chapters-per-day-option" style="display: none;">
                    <label for="chapters-per-day">Capítulos por dia de leitura:</label>
                    <input type="number" id="chapters-per-day" value="3" min="1">
                </div>
                
                <div id="days-option">
                    <label for="days-input">Total de dias de calendário para concluir:</label>
                    <input type="number" id="days-input" value="30" min="1">
                </div>

                <div id="end-date-option" style="display: none;">
                    <label for="start-date-input">Data de Início:</label>
                    <input type="date" id="start-date-input">
                    <label for="end-date-input">Data Final:</label>
                    <input type="date" id="end-date-input">
                </div>
                
                <hr>

                <fieldset id="periodicity-options">
                    <legend>Periodicidade (Dias da Semana)</legend>
                    <div id="periodicity-checkbox-group" class="checkbox-group">
                        <label><input type="checkbox" name="periodicity" value="0"> Dom</label>
                        <label><input type="checkbox" name="periodicity" value="1" checked> Seg</label>
                        <label><input type="checkbox" name="periodicity" value="2" checked> Ter</label>
                        <label><input type="checkbox" name="periodicity" value="3" checked> Qua</label>
                        <label><input type="checkbox" name="periodicity" value="4" checked> Qui</label>
                        <label><input type="checkbox" name="periodicity" value="5" checked> Sex</label>
                        <label><input type="checkbox" name="periodicity" value="6"> Sáb</label>
                    </div>
                </fieldset>
            </fieldset>

            <div id="plan-loading-create" class="loading-indicator" style="display: none;">Salvando plano...</div>
            <button id="create-plan-button" class="button-primary">Criar Plano</button>
            <button id="cancel-creation-button" class="button-secondary">Cancelar</button>
        </section>

        <!-- Seção de Reavaliação de Planos (Quadro de Carga) -->
        <section id="plan-reassessment-section" style="display: none;">
            <div class="reassessment-header">
                <h2>Quadro de Carga Semanal</h2>
                <div class="reassessment-actions">
                    <button id="sync-plans-button" class="button-primary">Sincronizar Planos</button>
                    <button id="close-reassessment-button" class="button-secondary">Voltar</button>
                </div>
            </div>
            <p class="reassessment-description">
                Visualize a carga de leitura de cada plano por dia da semana. Clique em um plano para editar seus dias ou arraste-o para remanejar a carga.
            </p>
            <div id="reassessment-grid" class="reassessment-grid-container">
                <!-- Conteúdo da grade será renderizado por plan-reassessment-ui.js -->
            </div>
            <div class="reassessment-legend-container">
                <h3>Legenda dos Planos</h3>
                <div id="reassessment-legend-list">
                    <!-- Legenda será renderizada por plan-reassessment-ui.js -->
                </div>
            </div>
        </section>

    </main>

    <!-- Navegador Flutuante (Dock) -->
    <div id="floating-navigator" class="hidden-at-bottom">
        <!-- Botões de navegação serão inseridos aqui por floating-navigator-ui.js -->
    </div>


    <!-- === MODAIS === -->

    <!-- Modal de Recálculo de Plano -->
    <div id="recalculate-modal" class="modal">
        <div class="modal-content">
            <span class="close-button">×</span>
            <h2>Recalcular Plano</h2>
            <div id="recalculate-error" class="error-message" style="display: none;"></div>
            
            <fieldset>
                <legend>Como proceder?</legend>
                <label><input type="radio" name="recalc-option" value="extend_date" checked> Manter o ritmo atual (estender data final)</label>
                <label><input type="radio" name="recalc-option" value="increase_pace"> Manter a data final original (aumentar ritmo)</label>
                <label>
                    <input type="radio" name="recalc-option" value="new_pace"> Definir novo ritmo de
                    <input type="number" id="new-pace-input" value="3" min="1">
                    capítulos/dia.
                </label>
            </fieldset>
            
            <!-- INÍCIO DA INSERÇÃO DO NOVO ELEMENTO -->
            <div id="recalc-preview-info" class="recalc-preview-container">
                <!-- O conteúdo aqui será preenchido dinamicamente pelo JavaScript -->
            </div>
            <!-- FIM DA INSERÇÃO -->

            <fieldset>
                <legend>Quando iniciar o recálculo?</legend>
                <label><input type="radio" name="recalc-start-option" value="today" checked> A partir de hoje</label>
                <label><input type="radio" name="recalc-start-option" value="next_reading_day"> A partir do próximo dia de leitura agendado</label>
                <label>
                    <input type="radio" name="recalc-start-option" value="specific_date"> Em uma data específica:
                    <input type="date" id="recalc-specific-date-input" style="display: none;">
                </label>
            </fieldset>

            <div id="recalculate-loading" class="loading-indicator" style="display: none;">Recalculando...</div>
            <button id="confirm-recalculate" class="button-primary">Confirmar Recálculo</button>
        </div>
    </div>
    
    <!-- Modal de Estatísticas -->
    <div id="stats-modal" class="modal">
        <div class="modal-content modal-content-scrollable">
            <span class="close-button">×</span>
            <h2>Estatísticas do Plano</h2>
            <div id="stats-loading" style="display: none;">Carregando...</div>
            <div id="stats-error" class="error-message" style="display: none;"></div>
            <div id="stats-content">
                <p><strong>Plano:</strong> <span id="stats-active-plan-name">--</span></p>
                <p><strong>Progresso:</strong> <span id="stats-active-plan-progress">--</span></p>
                <p><strong>Capítulos Lidos (do Log):</strong> <span id="stats-total-chapters">--</span></p>
                <p><strong>Ritmo Médio:</strong> <span id="stats-avg-pace">--</span></p>
                <p><strong>Previsão de Término:</strong> <span id="stats-forecast-date">--</span></p>
                <p><strong>Recálculos:</strong> <span id="stats-recalculations-count">--</span></p>
                <p><strong>Concluído:</strong> <span id="stats-plans-completed">--</span></p>
                
                <div class="stats-chart-container">
                    <canvas id="progress-chart"></canvas>
                </div>

                <div id="stats-plan-summary-container" style="display: none;">
                    <hr>
                    <h3>Resumo do Conteúdo</h3>
                    <div id="stats-plan-summary-list"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Histórico -->
    <div id="history-modal" class="modal">
        <div class="modal-content modal-content-scrollable">
            <span class="close-button">×</span>
            <h2>Histórico de Leitura</h2>
            <div id="history-loading" style="display: none;">Carregando...</div>
            <div id="history-error" class="error-message" style="display: none;"></div>
            <div id="history-list" class="history-list-container">
                <!-- Conteúdo do histórico será renderizado aqui por modals-ui.js -->
            </div>
        </div>
    </div>

    <!-- Modal de Sincronização de Planos -->
    <div id="sync-plans-modal" class="modal">
        <div class="modal-content">
            <span class="close-button">×</span>
            <h2>Sincronizar Término dos Planos</h2>
            <p>Ajuste múltiplos planos para terminarem na mesma data de um plano de referência.</p>
            <div id="sync-error" class="error-message" style="display: none;"></div>
            
            <fieldset>
                <label for="sync-base-plan-select">1. Escolha o plano de referência:</label>
                <select id="sync-base-plan-select"></select>
                <p>Data alvo de término: <strong id="sync-target-date-display">--/--/----</strong></p>
            </fieldset>

            <fieldset>
                <label>2. Selecione os planos para ajustar:</label>
                <div id="sync-plans-to-adjust-list" class="sync-plans-list">
                    <!-- Opções de planos serão renderizadas aqui -->
                </div>
            </fieldset>

            <div id="sync-loading" class="loading-indicator" style="display: none;">Sincronizando...</div>
            <button id="confirm-sync-button" class="button-primary">Sincronizar Planos</button>
        </div>
    </div>

    <!-- Modal Explorador da Bíblia -->
    <div id="bible-explorer-modal" class="modal">
        <div class="modal-content modal-content-scrollable">
            <span class="close-button">×</span>
            
            <div id="explorer-grid-view">
                <h2>Explorar Livros da Bíblia</h2>
                <p>Visualize todos os livros. Os que fazem parte de algum de seus planos são destacados.</p>
                <div id="explorer-book-grid" class="explorer-grid-container">
                    <!-- Cards dos livros serão renderizados aqui -->
                </div>
            </div>

            <div id="explorer-detail-view" style="display: none;">
                <div class="explorer-detail-header">
                    <button id="explorer-back-button" class="button-secondary">← Voltar</button>
                    <h2 id="explorer-detail-title"></h2>
                </div>
                <div id="explorer-chapter-list" class="explorer-list-container">
                    <!-- Capítulos serão renderizados aqui -->
                </div>
            </div>
        </div>
    </div>

    <script type="module" src="src/main.js"></script>
</body>
</html>
